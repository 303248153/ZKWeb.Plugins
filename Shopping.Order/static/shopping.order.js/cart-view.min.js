$.fn.userShippingAddressForm=function(){var e=$(this);if(!e.data("initialized")){e.data("initialized",!0);var a=e.find("[name='ShippingAddress']"),r=e.find("[name='SaveAddress']"),t=e.find("[name='ShippingAddressJson']"),i=e.find("[name='Fullname']"),n=e.find("[name='TelOrMobile']"),c=e.find("[name='Region']"),d=e.find("[name='ZipCode']"),o=e.find("[name='DetailedAddress']"),s="copyingLock",l="collect.userShippingAddressForm",u=function(){e.data(s,!0);var r=JSON.parse(a.val()||"{}")||{};i.val(r.ReceiverName),n.val(r.ReceiverTel),c.val(JSON.stringify({Country:r.Country,RegionId:r.RegionId})),c.closest(".region-editor").trigger("bindCountryAndRegion.RegionEditor"),d.val(r.ZipCode),o.val(r.DetailedAddress),e.data(s,!1),e.trigger(l)};a.on("change",u),e.bind(l,function(){if(!e.data(s)){var l=JSON.parse(a.val()||"{}")||{},u=JSON.parse(c.val()||"{}")||{},f={SelectedAddressId:l.Id||null,SaveAddress:r.is(":checked"),ReceiverName:i.val(),ReceiverTel:n.val(),Country:u.Country||null,RegionId:u.RegionId||null,ZipCode:d.val(),DetailedAddress:o.val()};t.val(JSON.stringify(f)).change()}}),e.find("input").not(t).on("change",function(){e.trigger(l)}),u.call(a)}},$(function(){var e=$(".cart-container"),a=e.find(".cart-product-table"),r=e.find("[name='createOrderProductParametersList']"),t=e.find("[name='cartProducts']"),i="cartProductChange.cartView",n=!1;e.on(i,function(){if(!n){n=!0;var e=[],i=0,c={};a.find(".cart-product").each(function(){var a=$(this),r=a.find(".selection input");if(r.is(":checked")){var t=a.find(".order-count input"),n=t.val()||0;if(0>=n)return void r.prop("checked",!1).change();var d=a.data("product-id"),o=a.data("matched-parameters")||"{}",s=a.data("cart-product-id");o.OrderCount=parseInt(a.find(".order-count input").val())||0,e.push({ProductId:d,MatchParameters:o,Extra:{cartProductId:s}}),i+=o.OrderCount;var s=a.data("cart-product-id");c[s]=o.OrderCount}}),a.find(".cart-product-total .total-count > em").text(i),r.val(JSON.stringify(e)).change(),t.val(JSON.stringify(c)).change(),n=!1}}),e.on("click",".delete",function(){var a=$(this),r=a.data("id");$.post("/api/cart/delete",{id:r},function(r){$(".minicart-menu").trigger("reinitialize.miniCart"),$.handleAjaxResult(r),a.closest("[role='row']").remove(),e.trigger(i)})}),a.on("change",".selection input",function(){e.trigger(i)});var c=null;a.on("change",".order-count input",function(){e.trigger(i),clearTimeout(c),c=setTimeout(function(){$.post("/api/cart/update_counts",{counts:t.val()},function(e){$.handleAjaxResult(e)})},1e3)}),r.attr("data-order-parameter","CreateOrderProductParametersList"),t.attr("data-order-parameter","CartProducts"),e.trigger(i)}),$(function(){var e=$(".cart-container"),a=e.find(".cart-product-total .total-price > em");e.on("calcPrice.cartView",function(){a.html(e.data("calculatingHtml"))}),e.on("calcPriceSuccess.cartView",function(){var r=e.data("priceInfo");a.text(r.orderProductTotalPriceString);var t=_.indexBy(e.find(".cart-product-table .cart-product"),function(e){return $(e).data("cart-product-id")});_.each(r.orderProductUnitPrices,function(e){var a=$(t[e.extra.cartProductId]),r=a.find(".unit-price .price");r.attr("title",e.description).text(e.priceString)})})}),$(function(){var e=$(".cart-container"),a=e.find(".cart-product-table"),r=e.find("[name='cartProducts']"),t=function(){var t=JSON.parse(r.val()||"{}"),i=_.indexBy(a.find(".cart-product"),function(e){return $(e).data("cart-product-id")}),n=_.any(t,function(e,a){return $(i[a]).data("is-real")}),c=e.find(".shipping-address");n?c.removeClass("hide"):c.addClass("hide")};r.on("change",t),t();var i=e.find(".user-shipping-address-form");i.userShippingAddressForm();var n=i.find("input[name='ShippingAddressJson']");n.attr("data-order-parameter","ShippingAddress")}),$(function(){var e=$(".cart-container");e.find("[name='OrderComment']").attr("data-order-parameter","OrderComment")}),$(function(){var e=$(".cart-container"),a=e.find(".logistics-select"),r=e.find("[name='sellerToLogistics']");a.on("change","input[type='radio']",function(){var e={};a.each(function(){var a=$(this),r=a.data("seller-id")||0,t=a.find("input[type='radio']:checked").val();e[r]=t}),r.val(JSON.stringify(e)).change()}),a.each(function(){$(this).find("input[type='radio']").first().prop("checked",!0).change()});var t=e.find(".cart-product-table"),i=e.find("[name='cartProducts']"),n=function(){var e=JSON.parse(i.val()||"{}"),r=_.indexBy(t.find(".cart-product"),function(e){return $(e).data("cart-product-id")}),n=[];_.each(e,function(e,a){var t=$(r[a]);t.data("is-real")&&n.push(t.data("seller-id")||0)}),a.each(function(){var e=$(this),a=e.data("seller-id")||0,r=_.contains(n,a);r?e.removeClass("hide"):e.addClass("hide")})};i.on("change",n),n()}),$(function(){var e=$(".cart-container"),a=e.find(".logistics-select");e.on("calcPriceSuccess.cartView",function(){var r=e.data("priceInfo");a.each(function(){var e=$(this),a=e.data("seller-id")||0,t=r.availableLogistics[a]||[],i=_.indexBy(t,"logisticsId");e.find("input[type='radio']").each(function(){var e=$(this),a=e.closest(".radio-inline"),r=i[e.val()];r?(a.removeClass("not-available"),a.find("em").remove(),a.append($("<em>").text("["+r.costString+"]"))):a.addClass("not-available")})})})}),$(function(){var e=$(".cart-container"),a=e.find(".payment-api-select"),r=e.find("[name='paymentApiId']");a.on("change","input[type='radio']",function(){r.val(a.find("input[type='radio']:checked").val()).change()}),a.find("input[type='radio']").first().prop("checked",!0).change()}),$(function(){var e=$(".cart-container"),a=e.find(".payment-api-select");e.on("calcPriceSuccess.cartView",function(){var r=e.data("priceInfo"),t=_.indexBy(r.availablePaymentApis,"apiId");a.find("input[type='radio']").each(function(){var e=$(this),a=e.closest(".radio-inline"),r=t[e.val()];r?(a.removeClass("not-available"),a.find("em").remove(),a.append($("<em>").text("["+r.feeString+"]"))):a.addClass("not-available")})})}),$(function(){var e=$(".cart-container"),a=e.find(".btn-submit-order [name='CreateOrderParameters']"),r="createOrderParametersChange.cartView",t="collectCreateOrderParametersEventName.cartView";e.on(t,function(){var t={OrderParameters:{},OrderProductParametersList:[]};e.find("[data-order-parameter]").each(function(){var e=$(this),a=e.attr("data-order-parameter"),r=$("<div>").attr("data-val",e.val()).data("val");"CreateOrderProductParametersList"===a?t.OrderProductParametersList=r:t.OrderParameters[a]=r}),a.val(JSON.stringify(t)),e.data("createOrderParameters",t),e.trigger(r)}),e.on("change","[data-order-parameter]",function(){e.trigger(t)}),e.trigger(t)}),$(function(){var e=$(".cart-container"),a=e.find(".order-price-description .description"),r=a.html(),t="calcPrice.cartView",i="calcPriceSuccess.cartView",n="lastCalcPriceTimeStamp",c=null;e.data("calculatingHtml",r),e.on(t,function(){a.html(r),clearTimeout(c),c=setTimeout(function(){var r=e.data("createOrderParameters");if(!$.isEmptyObject(r)){var t=Date.now();e.data(n,t);var c={CreateOrderParameters:JSON.stringify(r)};$.post("/api/cart/calculate_price",c,function(r){if(t===e.data(n)){var c=r.priceInfo;c?(a.text(c.orderPriceDescription+" = "+c.orderPriceString),e.data("priceInfo",c),e.trigger(i)):a.text(r.error)}})}},1e3)}),e.on("createOrderParametersChange.cartView",function(){e.trigger(t)}),e.trigger(t)});