$.fn.userShippingAddressForm=function(){var e=$(this);if(!e.data("initialized")){e.data("initialized",!0);var r=e.find("[name='ShippingAddress']"),t=e.find("[name='SaveAddress']"),a=e.find("[name='ShippingAddressJson']"),i=e.find("[name='Fullname']"),n=e.find("[name='TelOrMobile']"),d=e.find("[name='Region']"),c=e.find("[name='ZipCode']"),o=e.find("[name='DetailedAddress']"),s="copyingLock",u="collect.userShippingAddressForm",l=function(){e.data(s,!0);var t=JSON.parse(r.val()||"{}")||{};i.val(t.ReceiverName),n.val(t.ReceiverTel),d.val(JSON.stringify({Country:t.Country,RegionId:t.RegionId})),d.closest(".region-editor").trigger("bindCountryAndRegion.RegionEditor"),c.val(t.ZipCode),o.val(t.DetailedAddress),e.data(s,!1),e.trigger(u)};r.on("change",l),e.bind(u,function(){if(!e.data(s)){var u=JSON.parse(r.val()||"{}")||{},l=JSON.parse(d.val()||"{}")||{},p={SelectedAddressId:u.Id||null,SaveAddress:t.is(":checked"),ReceiverName:i.val(),ReceiverTel:n.val(),Country:l.Country||null,RegionId:l.RegionId||null,ZipCode:c.val(),DetailedAddress:o.val()};a.val(JSON.stringify(p)).change()}}),e.find("input").not(a).on("change",function(){e.trigger(u)}),l.call(r)}},$(function(){var e=$(".cart-container"),r=e.find(".cart-product-table"),t=e.find("[name='createOrderProductParametersList']"),a=e.find("[name='cartProducts']"),i="cartProductChange.cartView",n=!1;e.on(i,function(){if(!n){n=!0;var e=[],i=0,d={};r.find(".cart-product").each(function(){var r=$(this),t=r.find(".selection input");if(t.is(":checked")){var a=r.find(".order-count input"),n=a.val()||0;if(0>=n)return void t.prop("checked",!1).change();var c=r.data("product-id"),o=r.data("matched-parameters")||"{}";o.OrderCount=parseInt(r.find(".order-count input").val())||0,e.push({ProductId:c,MatchParameters:o}),i+=o.OrderCount;var s=r.data("cart-product-id");d[s]=o.OrderCount}}),r.find(".cart-product-total .total-count > em").text(i),t.val(JSON.stringify(e)).change(),a.val(JSON.stringify(d)).change(),n=!1}}),e.on("click",".delete",function(){var r=$(this),t=r.data("id");$.post("/api/cart/delete",{id:t},function(t){$(".minicart-menu").trigger("reinitialize.miniCart"),$.handleAjaxResult(t),r.closest("[role='row']").remove(),e.trigger(i)})}),r.on("change",".selection input",function(){e.trigger(i)});var d=null;r.on("change",".order-count input",function(){e.trigger(i),clearTimeout(d),d=setTimeout(function(){$.post("/api/cart/update_counts",{counts:a.val()},function(e){$.handleAjaxResult(e)})},1e3)}),t.attr("data-order-parameter","CreateOrderProductParametersList"),a.attr("data-order-parameter","CartProducts"),e.trigger(i)}),$(function(){var e=$(".cart-container"),r=e.find(".cart-product-table"),t=e.find("[name='cartProducts']"),a=function(){var a=JSON.parse(t.val()||"{}"),i=_.indexBy(r.find(".cart-product"),function(e){return $(e).data("cart-product-id")}),n=_.any(a,function(e,r){return $(i[r]).data("is-real")}),d=e.find(".shipping-address");n?d.removeClass("hide"):d.addClass("hide")};t.on("change",a),a();var i=e.find(".user-shipping-address-form");i.userShippingAddressForm();var n=i.find("input[name='ShippingAddressJson']");n.attr("data-order-parameter","ShippingAddress")}),$(function(){var e=$(".cart-container");e.find("[name='OrderComment']").attr("data-order-parameter","OrderComment")}),$(function(){var e=$(".cart-container"),r=e.find(".logistics-select"),t=e.find("[name='sellerToLogistics']");r.on("change","input[type='radio']",function(){var e={};r.each(function(){var r=$(this),t=r.data("seller-id")||0,a=r.find("input[type='radio']:checked").val();e[t]=a}),t.val(JSON.stringify(e)).change()}),r.each(function(){$(this).find("input[type='radio']").first().prop("checked",!0).change()})}),$(function(){var e=$(".cart-container"),r=e.find(".payment-api-select"),t=e.find("[name='paymentApiId']");r.on("change","input[type='radio']",function(){t.val(r.find("input[type='radio']:checked").val()).change()}),r.find("input[type='radio']").first().prop("checked",!0).change()}),$(function(){var e=$(".cart-container"),r="createOrderParametersChange.cartView",t="collectCreateOrderParametersEventName.cartView";e.on(t,function(){var t={OrderParameters:{},OrderProductParametersList:[]};e.find("[data-order-parameter]").each(function(){var e=$(this),r=e.attr("data-order-parameter"),a=$("<div>").attr("data-val",e.val()).data("val");"CreateOrderProductParametersList"===r?t.OrderProductParametersList=a:t.OrderParameters[r]=a}),e.data("createOrderParameters",t),e.trigger(r)}),e.on("change","[data-order-parameter]",function(){e.trigger(t)}),e.trigger(t)}),$(function(){var e=$(".cart-container"),r=e.find(".cart-product-total .total-price > em"),t=e.find(".order-price-description .description"),a=t.html(),i="calcPrice.cartView",n="calcPriceSuccess.cartView",d="lastCalcPriceTimeStamp",c=null;e.on(i,function(){r.html(a),t.html(a),clearTimeout(c),c=setTimeout(function(){var a=e.data("createOrderParameters");if(!$.isEmptyObject(a)){var i=Date.now();e.data(d,i);var c={CreateOrderParameters:JSON.stringify(a)};$.post("/api/cart/calculate_price",c,function(a){if(i===e.data(d)){var c=a.priceInfo;c?(r.text(c.orderProductTotalPriceString),t.text(c.orderPriceDescription+" = "+c.orderPriceString),e.data("priceInfo",c),e.trigger(n)):t.text(a.error)}})}},1e3)}),e.on("createOrderParametersChange.cartView",function(){e.trigger(i)}),e.trigger(i)});