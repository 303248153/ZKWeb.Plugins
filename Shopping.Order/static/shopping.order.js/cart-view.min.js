$.fn.userShippingAddressForm=function(){var a=$(this);if(!a.data("initialized")){a.data("initialized",!0);var e=a.find("[name='ShippingAddress']"),r=a.find("[name='SaveAddress']"),t=a.find("[name='ShippingAddressJson']"),i=a.find("[name='Fullname']"),n=a.find("[name='TelOrMobile']"),c=a.find("[name='Region']"),d=a.find("[name='ZipCode']"),o=a.find("[name='DetailedAddress']"),s="copyingLock",l="collect.userShippingAddressForm",u=function(){a.data(s,!0);var r=JSON.parse(e.val()||"{}")||{};i.val(r.ReceiverName),n.val(r.ReceiverTel),c.val(JSON.stringify({Country:r.Country,RegionId:r.RegionId})),c.closest(".region-editor").trigger("bindCountryAndRegion.RegionEditor"),d.val(r.ZipCode),o.val(r.DetailedAddress),a.data(s,!1),a.trigger(l)};e.on("change",u),a.bind(l,function(){if(!a.data(s)){var l=JSON.parse(e.val()||"{}")||{},u=JSON.parse(c.val()||"{}")||{},p={SelectedAddressId:l.Id||null,SaveAddress:r.is(":checked"),ReceiverName:i.val(),ReceiverTel:n.val(),Country:u.Country||null,RegionId:u.RegionId||null,ZipCode:d.val(),DetailedAddress:o.val()};t.val(JSON.stringify(p)).change()}}),a.find("input").not(t).on("change",function(){a.trigger(l)}),u.call(e)}},$(function(){var a=$(".cart-container"),e=a.find(".cart-product-table"),r=a.find("[name='createOrderProductParametersList']"),t=a.find("[name='cartProducts']"),i="cartProductChange.cartView",n=!1;a.on(i,function(){if(!n){n=!0;var a=[],i=0,c={};e.find(".cart-product").each(function(){var e=$(this),r=e.find(".selection input");if(r.is(":checked")){var t=e.find(".order-count input"),n=t.val()||0;if(0>=n)return void r.prop("checked",!1).change();var d=e.data("product-id"),o=e.data("matched-parameters")||"{}",s=e.data("cart-product-id");o.OrderCount=parseInt(e.find(".order-count input").val())||0,a.push({ProductId:d,MatchParameters:o,Extra:{cartProductId:s}}),i+=o.OrderCount;var s=e.data("cart-product-id");c[s]=o.OrderCount}}),e.find(".cart-product-total .total-count > em").text(i),r.val(JSON.stringify(a)).change(),t.val(JSON.stringify(c)).change(),n=!1}}),a.on("click",".delete",function(){var e=$(this),r=e.data("id");$.post("/api/cart/delete",{id:r},function(r){$(".minicart-menu").trigger("reinitialize.miniCart"),$.handleAjaxResult(r),e.closest("[role='row']").remove(),a.trigger(i)})}),e.on("change",".selection input",function(){a.trigger(i)});var c=null;e.on("change",".order-count input",function(){a.trigger(i),clearTimeout(c),c=setTimeout(function(){$.post("/api/cart/update_counts",{counts:t.val()},function(a){$.handleAjaxResult(a)})},1e3)}),r.attr("data-order-parameter","CreateOrderProductParametersList"),t.attr("data-order-parameter","CartProducts"),a.trigger(i)}),$(function(){var a=$(".cart-container"),e=a.find(".cart-product-total .total-price > em");a.on("calcPrice.cartView",function(){e.html(a.data("calculatingHtml"))}),a.on("calcPriceSuccess.cartView",function(){var r=a.data("priceInfo");e.text(r.orderProductTotalPriceString);var t=_.indexBy(a.find(".cart-product-table .cart-product"),function(a){return $(a).data("cart-product-id")});_.each(r.orderProductUnitPrices,function(a){var e=$(t[a.extra.cartProductId]),r=e.find(".unit-price .price");r.attr("title",a.description).text(a.priceString)})})}),$(function(){var a=$(".cart-container"),e=a.find(".cart-product-table"),r=a.find("[name='cartProducts']"),t=function(){var t=JSON.parse(r.val()||"{}"),i=_.indexBy(e.find(".cart-product"),function(a){return $(a).data("cart-product-id")}),n=_.any(t,function(a,e){return $(i[e]).data("is-real")}),c=a.find(".shipping-address");n?c.removeClass("hide"):c.addClass("hide")};r.on("change",t),t();var i=a.find(".user-shipping-address-form");i.userShippingAddressForm();var n=i.find("input[name='ShippingAddressJson']");n.attr("data-order-parameter","ShippingAddress")}),$(function(){var a=$(".cart-container");a.find("[name='OrderComment']").attr("data-order-parameter","OrderComment")}),$(function(){var a=$(".cart-container"),e=a.find(".logistics-select"),r=a.find("[name='sellerToLogistics']");e.on("change","input[type='radio']",function(){var a={};e.each(function(){var e=$(this),r=e.data("seller-id")||0,t=e.find("input[type='radio']:checked").val();a[r]=t}),r.val(JSON.stringify(a)).change()}),e.each(function(){$(this).find("input[type='radio']").first().prop("checked",!0).change()});var t=a.find(".cart-product-table"),i=a.find("[name='cartProducts']"),n=function(){var a=JSON.parse(i.val()||"{}"),r=_.indexBy(t.find(".cart-product"),function(a){return $(a).data("cart-product-id")}),n=[];_.each(a,function(a,e){var t=$(r[e]);t.data("is-real")&&n.push(t.data("seller-id")||0)}),e.each(function(){var a=$(this),e=a.data("seller-id")||0,r=_.contains(n,e);r?a.removeClass("hide"):a.addClass("hide")})};i.on("change",n),n()}),$(function(){var a=$(".cart-container"),e=a.find(".logistics-select");a.on("calcPriceSuccess.cartView",function(){var r=a.data("priceInfo");e.each(function(){var a=$(this),e=a.data("seller-id")||0,t=r.availableLogistics[e]||[],i=_.indexBy(t,"logisticsId");a.find("input[type='radio']").each(function(){var a=$(this),e=a.closest(".radio-inline"),r=i[a.val()];r?(e.removeClass("not-available"),e.find("em").remove(),e.append($("<em>").text("["+r.costString+"]"))):e.addClass("not-available")})})})}),$(function(){var a=$(".cart-container"),e=a.find(".payment-api-select"),r=a.find("[name='paymentApiId']");e.on("change","input[type='radio']",function(){r.val(e.find("input[type='radio']:checked").val()).change()}),e.find("input[type='radio']").first().prop("checked",!0).change()}),$(function(){var a=$(".cart-container"),e=a.find(".payment-api-select");a.on("calcPriceSuccess.cartView",function(){var r=a.data("priceInfo"),t=_.indexBy(r.availablePaymentApis,"apiId");e.find("input[type='radio']").each(function(){var a=$(this),e=a.closest(".radio-inline"),r=t[a.val()];r?(e.removeClass("not-available"),e.find("em").remove(),e.append($("<em>").text("["+r.feeString+"]"))):e.addClass("not-available")})})}),$(function(){var a=$(".cart-container"),e="createOrderParametersChange.cartView",r="collectCreateOrderParametersEventName.cartView";a.on(r,function(){var r={OrderParameters:{},OrderProductParametersList:[]};a.find("[data-order-parameter]").each(function(){var a=$(this),e=a.attr("data-order-parameter"),t=$("<div>").attr("data-val",a.val()).data("val");"CreateOrderProductParametersList"===e?r.OrderProductParametersList=t:r.OrderParameters[e]=t}),a.data("createOrderParameters",r),a.trigger(e)}),a.on("change","[data-order-parameter]",function(){a.trigger(r)}),a.trigger(r)}),$(function(){var a=$(".cart-container"),e=a.find(".order-price-description .description"),r=e.html(),t="calcPrice.cartView",i="calcPriceSuccess.cartView",n="lastCalcPriceTimeStamp",c=null;a.data("calculatingHtml",r),a.on(t,function(){e.html(r),clearTimeout(c),c=setTimeout(function(){var r=a.data("createOrderParameters");if(!$.isEmptyObject(r)){var t=Date.now();a.data(n,t);var c={CreateOrderParameters:JSON.stringify(r)};$.post("/api/cart/calculate_price",c,function(r){if(t===a.data(n)){var c=r.priceInfo;c?(e.text(c.orderPriceDescription+" = "+c.orderPriceString),a.data("priceInfo",c),a.trigger(i)):e.text(r.error)}})}},1e3)}),a.on("createOrderParametersChange.cartView",function(){a.trigger(t)}),a.trigger(t)});