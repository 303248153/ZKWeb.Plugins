$(function(){var t=$(".cart-container"),r=t.find(".cart-product-table"),a=t.find("[name='createOrderProductParametersList']"),e=t.find("[name='cartProducts']"),n="cartProductChange.cartView",i=!1;t.on(n,function(){if(!i){i=!0;var t=[],n=0,d={};r.find(".cart-product").each(function(){var r=$(this),a=r.find(".selection input");if(a.is(":checked")){var e=r.find(".order-count input"),i=e.val()||0;if(0>=i)return void a.prop("checked",!1).change();var c=r.data("product-id"),o=r.data("matched-parameters")||"{}";o.OrderCount=parseInt(r.find(".order-count input").val())||0,t.push({ProductId:c,MatchParameters:o}),n+=o.OrderCount;var u=r.data("cart-product-id");d[u]=o.OrderCount}}),r.find(".cart-product-total .total-count > em").text(n),a.val(JSON.stringify(t)).change(),e.val(JSON.stringify(d)).change(),i=!1}}),t.on("click",".delete",function(){var r=$(this),a=r.data("id");$.post("/api/cart/delete",{id:a},function(a){$(".minicart-menu").trigger("reinitialize.miniCart"),$.handleAjaxResult(a),r.closest("[role='row']").remove(),t.trigger(n)})}),r.on("change",".selection input",function(){t.trigger(n)});var d=null;r.on("change",".order-count input",function(){t.trigger(n),clearTimeout(d),d=setTimeout(function(){$.post("/api/cart/update_counts",{counts:e.val()},function(t){$.handleAjaxResult(t)})},1e3)}),a.attr("data-order-parameter","CreateOrderProductParametersList"),e.attr("data-order-parameter","CartProducts"),t.trigger(n)}),$(function(){var t=$(".cart-container"),r=t.find(".cart-product-table"),a=t.find("[name='cartProducts']");a.on("change",function(){var e=JSON.parse(a.val()||"{}"),n=_.indexBy(r.find(".cart-product"),function(t){return $(t).data("cart-product-id")}),i=_.any(e,function(t,r){return $(n[r]).data("is-real")}),d=t.find(".shipping-address"),c=t.find(".logistics-select");i?d.removeClass("hide"):d.addClass("hide"),i?c.removeClass("hide"):c.addClass("hide")});var e=t.find(".user-shipping-address-form"),n=e.find("input[name='ShippingAddressJson']");n.attr("data-order-parameter","ShippingAddress")}),$(function(){});