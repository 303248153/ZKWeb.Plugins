!function(){var n=null,t={},o={},i=function(t){return null!=n?void t():void $.post("/api/region/country_info",function(o){n=o,t()})},e=function(n,i){var e=t[n]||null;return null!=e?void i():void $.post("/api/region/region_tree_from_country",{country:n},function(e){var r=e.tree;t[n]=r;var a={},d=function(n){_.each(n.Childs,function(n){a[n.Value.Id]=n,d(n)})};d(r),o[n]=a,i()})};$.fn.regionEditor=function(){var r=$(this),a=r.data("initialized");if(!a){r.data("initialized",!0);var d=$(this).find("input[type=hidden]"),u=r.data("display-country-dropdown"),c=$("<div>").attr("class","country-dropdown").appendTo(r),l=$("<div>").attr("class","regions-dropdown").appendTo(r),f=function(){return JSON.parse(d.val()||"{}")||{}},p=function(n){d.val(JSON.stringify(n))},s=function(n){if($.isEmptyObject(n.Childs))return $();var t=$("<select>").addClass("form-control");return t.append($("<option>").text("-").val("")),_.each(n.Childs,function(n){t.append($("<option>").text(n.Value.Name).val(n.Value.Id))}),t},v="bindCountry.regionEditor";r.on(v,function(){var t=f();t.Country=t.Country||n.defaultCountry,p(t),c.find("select").val(t.Country)});var g="bindRegion.regionEditor";r.on(g,function(){for(var n=f(),i=t[n.Country]||{},e=o[n.Country]||{},r=[],a=e[n.RegionId];a;)r.push(a),a=e[a.Value.ParentId];r.reverse(),l.empty(),_.each(r,function(n){var t=e[n.Value.ParentId]||i,o=s(t);o.val(n.Value.Id),l.append(o)}),l.append(s(_.last(r)||i))}),c.on("change","select",function(){var n=$(this).val();p({Country:n,RegionId:null}),e(n,function(){r.trigger(g)})}),l.on("change","select",function(){var n=$(this),t=c.find("select").val(),i=null;n.nextAll().remove(),n.parent().find("select").each(function(){var n=$(this).val();n&&(i=n)}),p({Country:t,RegionId:i});var e=(o[t]||{})[n.val()];e&&l.append(s(e))}),i(function(){c.empty();var t=$("<select>").addClass("form-control");_.each(n.countries,function(n){t.append($("<option>").text(n.Name).val(n.Value))}),u?t.show():t.hide(),c.append(t),r.trigger(v),e(t.val(),function(){r.trigger(g)})})}}}(),$(function(){var n="[data-trigger=region-editor]";$(n).each(function(){$(this).regionEditor()}),$(document).on("dynamicLoaded",function(t,o){$(o).find(n).each(function(){$(this).regionEditor()})})});