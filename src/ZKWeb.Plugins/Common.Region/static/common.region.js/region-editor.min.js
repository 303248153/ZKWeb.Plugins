!function(){var n=null,t={},o={},i=function(t){return null!==n?void t():void $.post("/api/region/country_info",function(o){n=o,t()})},e=function(n,i){var e=t[n]||null;return null!==e?void i():void $.post("/api/region/region_tree_from_country",{country:n},function(e){var r=e.tree;t[n]=r;var a={},d=function(n){_.each(n.Childs,function(n){a[n.Value.Id]=n,d(n)})};d(r),o[n]=a,i()})};$.fn.regionEditor=function(){var r=$(this),a=r.data("initialized");if(!a){r.data("initialized",!0);var d=r.find(".loading"),u=r.find("input[type=hidden]"),c=r.data("display-country-dropdown"),l=$("<div>").attr("class","country-dropdown").appendTo(r),f=$("<div>").attr("class","regions-dropdown").appendTo(r),p=function(){return JSON.parse(u.val()||"{}")||{}},s=function(n){u.val(JSON.stringify(n)).change()},v=function(n){if($.isEmptyObject(n.Childs))return $();var t=$("<select>").addClass("form-control");return t.append($("<option>").text("-").val("")),_.each(n.Childs,function(n){t.append($("<option>").text(n.Value.Name).val(n.Value.Id))}),t},g="bindCountry.regionEditor";r.on(g,function(){var t=p();t.Country=t.Country||n.defaultCountry,s(t),l.find("select").val(t.Country)});var h="bindRegion.regionEditor";r.on(h,function(){for(var n=p(),i=t[n.Country]||{},e=o[n.Country]||{},r=[],a=e[n.RegionId];a;)r.push(a),a=e[a.Value.ParentId];r.reverse(),f.empty(),_.each(r,function(n){var t=e[n.Value.ParentId]||i,o=v(t);o.val(n.Value.Id),f.append(o)}),f.append(v(_.last(r)||i))}),l.on("change","select",function(){var n=$(this).val();s({Country:n,RegionId:null}),f.empty(),d.show(),e(n,function(){d.hide(),r.trigger(h)})}),f.on("change","select",function(){var n=$(this),t=l.find("select").val(),i=null;n.nextAll().remove(),n.parent().find("select").each(function(){var n=$(this).val();n&&(i=n)}),s({Country:t,RegionId:i});var e=(o[t]||{})[n.val()];e&&f.append(v(e))});var y="bindCountryAndRegion.RegionEditor";r.on(y,function(){d.show(),i(function(){l.empty();var t=$("<select>").addClass("form-control");_.each(n.countries,function(n){t.append($("<option>").text(n.Name).val(n.Value))}),c?t.show():t.hide(),l.append(t),r.trigger(g),e(t.val(),function(){d.hide(),r.trigger(h)})})}).trigger(y)}}}(),$(function(){var n="[data-trigger=region-editor]";$(n).each(function(){$(this).regionEditor()}),$(document).on("dynamicLoaded",function(t,o){$(o).find(n).each(function(){$(this).regionEditor()})})});