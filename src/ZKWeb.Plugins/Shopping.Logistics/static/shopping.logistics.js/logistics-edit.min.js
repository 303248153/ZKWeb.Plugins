$.fn.logisticsPriceRulesEditor=function(){var t=$(this);if(!t.data("initialized")){t.data("initialized",!0);var e=t.data("price-rules-name"),n=t.data("table-class"),a=t.data("table-header-class"),i=t.data("display-country-dropdown"),d=t.data("currency-list-items"),r=t.data("default-price-rule"),o=t.closest("form").find("[name='"+e+"']");if(o.length<=0)return void console.warn("init logistics price rule editor failed",o);var s=$.translate("Default"),l=$.translate("Region"),c=$.translate("FirstHeavyUnit(g)"),u=$.translate("FirstHeavyCost"),p=$.translate("ContinuedHeavyUnit(g)"),y=$.translate("ContinuedHeavyCost"),v=$.translate("Currency"),f=$.translate("Disabled"),g=t.editableTable({tableClass:n,tableHeaderClass:a,columns:[l,c,u,p,y,v,f]}),C=g.find("tbody"),h="addRow.editableTable";g.on(h,function(t,e){var n=$("<tr>");n.append($("<td>").addClass("region").append($("<div>").addClass("region-editor").attr("data-trigger","region-editor").attr("data-display-country-dropdown",""+i).append($("<input>").attr("type","hidden")))),_.each([["first-heavy-unit",c],["first-heavy-cost",u],["continued-heavy-unit",p],["continued-heavy-cost",y]],function(t){n.append($("<td>").addClass(t[0]).append($("<input>").addClass("form-control").attr("type","text").attr("placeholder",t[1])))}),n.append($("<td>").addClass("currency").append($("<select>").addClass("form-control").append(_.map(d,function(t){return $("<option>").attr("value",t.Value).text(t.Name)})))),n.append($("<td>").addClass("disabled").append($("<input>").attr("type","checkbox"))),n.append(g.data("actionsCell").clone());var a=$.isEmptyObject(e)?r:e,o=n.find(".region .region-editor"),l=o.find("input[type=hidden]"),v=JSON.parse(l.val()||"{}");v.Country=a.Country,v.RegionId=a.RegionId,l.val(JSON.stringify(v)),n.find(".first-heavy-unit input").val(a.FirstHeavyUnit),n.find(".first-heavy-cost input").val(a.FirstHeavyCost),n.find(".continued-heavy-unit input").val(a.ContinuedHeavyUnit),n.find(".continued-heavy-cost input").val(a.ContinuedHeavyCost),n.find(".currency select").val(a.Currency),n.find(".disabled input").prop("checked",a.Disabled),v.Country?o.regionEditor():n.find(".region").empty().text(s),$.isEmptyObject(e)?C.prepend(n):C.append(n)});var b="bind.editableTable",m="collect.editableTable",H="bindLock.editableTable";g.on(b,function(){t.data(H,!0);var e=JSON.parse(o.val()||"[]")||[];e.length&&$.isEmptyObject(_.last(e).Conditions)||e.push($.extend({},r,{Country:null})),o.val(JSON.stringify(e)),C.empty(),_.each(e,function(t){g.trigger(h,[t])}),t.data(H,!1)}),t.on(m,function(){if(!t.data(H)){var e=[],n=C.find("> tr");n.each(function(){var t=$(this),n=t.find(".region .region-editor"),a=n.find("input[type=hidden]"),i=JSON.parse(a.val()||"{}");e.push({Country:i.Country,RegionId:i.RegionId,FirstHeavyUnit:t.find(".first-heavy-unit input").val(),FirstHeavyCost:t.find(".first-heavy-cost input").val(),ContinuedHeavyUnit:t.find(".continued-heavy-unit input").val(),ContinuedHeavyCost:t.find(".continued-heavy-cost input").val(),Currency:t.find(".currency select").val(),Disabled:t.find(".disabled input").is(":checked")})}),o.val(JSON.stringify(e))}}),g.trigger(b)}},$(function(){var t=function(t){t.each(function(){$(this).logisticsPriceRulesEditor()})},e="[data-toggle='logistics-price-rules-editor']";t($(e)),$(document).on("dynamicLoaded",function(n,a){t($(a).find(e))})});