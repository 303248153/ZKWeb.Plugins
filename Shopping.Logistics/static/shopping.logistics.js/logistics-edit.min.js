$.fn.logisticsPriceRulesEditor=function(){var t=$(this);if(!t.data("initialized")){t.data("initialized",!0);var n=t.data("price-rules-name"),i=(t.data("table-class"),t.data("table-header-class"),t.data("display-country-dropdown")),e=t.data("currency-list-items"),a=t.data("default-price-rule"),d=t.data("translations")||{},r=t.closest("form").find("[name='"+n+"']");if(r.length<=0)return void console.warn("init logistics price rule editor failed",r);var o=function(t){return d[t]||t},s=o("Default"),l=o("Region"),c=o("FirstHeavyUnit(g)"),u=o("FirstHeavyCost"),p=o("ContinuedHeavyUnit(g)"),y=o("ContinuedHeavyCost"),f=o("Currency"),v=o("Disabled"),g=t.editableTable({columns:[l,c,u,p,y,f,v]}),h=g.find("tbody"),C="addRow.editableTable";g.on(C,function(t,n){var d=$("<tr>");d.append($("<td>").addClass("region").append($("<div>").addClass("region-editor").attr("data-trigger","region-editor").attr("data-display-country-dropdown",""+i).append($("<input>").attr("type","hidden")))),_.each([["first-heavy-unit",c],["first-heavy-cost",u],["continued-heavy-unit",p],["continued-heavy-cost",y]],function(t){d.append($("<td>").addClass(t[0]).append($("<input>").addClass("form-control").attr("type","text").attr("placeholder",t[1])))}),d.append($("<td>").addClass("currency").append($("<select>").addClass("form-control").append(_.map(e,function(t){return $("<option>").attr("value",t.Value).text(t.Name)})))),d.append($("<td>").addClass("disabled").append($("<input>").attr("type","checkbox"))),d.append(g.data("actionsCell").clone());var r=$.isEmptyObject(n)?a:n,o=d.find(".region .region-editor"),l=o.find("input[type=hidden]"),f=JSON.parse(l.val()||"{}");f.Country=r.Country,f.RegionId=r.RegionId,l.val(JSON.stringify(f)),d.find(".first-heavy-unit input").val(r.FirstHeavyUnit),d.find(".first-heavy-cost input").val(r.FirstHeavyCost),d.find(".continued-heavy-unit input").val(r.ContinuedHeavyUnit),d.find(".continued-heavy-cost input").val(r.ContinuedHeavyCost),d.find(".currency select").val(r.Currency),d.find(".disabled input").prop("checked",r.Disabled),f.Country?o.regionEditor():d.find(".region").empty().text(s),$.isEmptyObject(n)?h.prepend(d):h.append(d)});var b="bind.editableTable",m="collect.editableTable",H="bindLock.editableTable";g.on(b,function(){t.data(H,!0);var n=JSON.parse(r.val()||"[]")||[];n.length&&$.isEmptyObject(_.last(n).Conditions)||n.push($.extend({},a,{Country:null})),r.val(JSON.stringify(n)),h.empty(),_.each(n,function(t){g.trigger(C,[t])}),t.data(H,!1)}),t.on(m,function(){if(!t.data(H)){var n=[],i=h.find("> tr");i.each(function(){var t=$(this),i=t.find(".region .region-editor"),e=i.find("input[type=hidden]"),a=JSON.parse(e.val()||"{}");n.push({Country:a.Country,RegionId:a.RegionId,FirstHeavyUnit:t.find(".first-heavy-unit input").val(),FirstHeavyCost:t.find(".first-heavy-cost input").val(),ContinuedHeavyUnit:t.find(".continued-heavy-unit input").val(),ContinuedHeavyCost:t.find(".continued-heavy-cost input").val(),Currency:t.find(".currency select").val(),Disabled:t.find(".disabled input").is(":checked")})}),r.val(JSON.stringify(n))}}),g.trigger(b)}},$(function(){var t=function(t){t.each(function(){$(this).logisticsPriceRulesEditor()})},n="[data-toggle='logistics-price-rules-editor']";t($(n)),$(document).on("dynamicLoaded",function(i,e){t($(e).find(n))})});