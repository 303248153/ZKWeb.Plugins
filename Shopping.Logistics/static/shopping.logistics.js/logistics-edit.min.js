$.fn.logisticsPriceRulesEditor=function(){var t=$(this);if(!t.data("initialized")){t.data("initialized",!0);var e=t.data("price-rules-name"),n=t.data("table-class"),i=t.data("table-header-class"),a=t.data("display-country-dropdown"),d=t.data("currency-list-items"),r=t.data("default-price-rule"),o=t.data("translations")||{},s=t.closest("form").find("[name='"+e+"']");if(s.length<=0)return void console.warn("init logistics price rule editor failed",s);var l=function(t){return o[t]||t},c=l("Default"),u=l("Region"),p=l("FirstHeavyUnit(g)"),y=l("FirstHeavyCost"),f=l("ContinuedHeavyUnit(g)"),v=l("ContinuedHeavyCost"),g=l("Currency"),C=l("Disabled"),h=t.editableTable({tableClass:n,tableHeaderClass:i,columns:[u,p,y,f,v,g,C]}),b=h.find("tbody"),m="addRow.editableTable";h.on(m,function(t,e){var n=$("<tr>");n.append($("<td>").addClass("region").append($("<div>").addClass("region-editor").attr("data-trigger","region-editor").attr("data-display-country-dropdown",""+a).append($("<input>").attr("type","hidden")))),_.each([["first-heavy-unit",p],["first-heavy-cost",y],["continued-heavy-unit",f],["continued-heavy-cost",v]],function(t){n.append($("<td>").addClass(t[0]).append($("<input>").addClass("form-control").attr("type","text").attr("placeholder",t[1])))}),n.append($("<td>").addClass("currency").append($("<select>").addClass("form-control").append(_.map(d,function(t){return $("<option>").attr("value",t.Value).text(t.Name)})))),n.append($("<td>").addClass("disabled").append($("<input>").attr("type","checkbox"))),n.append(h.data("actionsCell").clone());var i=$.isEmptyObject(e)?r:e,o=n.find(".region .region-editor"),s=o.find("input[type=hidden]"),l=JSON.parse(s.val()||"{}");l.Country=i.Country,l.RegionId=i.RegionId,s.val(JSON.stringify(l)),n.find(".first-heavy-unit input").val(i.FirstHeavyUnit),n.find(".first-heavy-cost input").val(i.FirstHeavyCost),n.find(".continued-heavy-unit input").val(i.ContinuedHeavyUnit),n.find(".continued-heavy-cost input").val(i.ContinuedHeavyCost),n.find(".currency select").val(i.Currency),n.find(".disabled input").prop("checked",i.Disabled),l.Country?o.regionEditor():n.find(".region").empty().text(c),$.isEmptyObject(e)?b.prepend(n):b.append(n)});var H="bind.editableTable",O="collect.editableTable",R="bindLock.editableTable";h.on(H,function(){t.data(R,!0);var e=JSON.parse(s.val()||"[]")||[];e.length&&$.isEmptyObject(_.last(e).Conditions)||e.push($.extend({},r,{Country:null})),s.val(JSON.stringify(e)),b.empty(),_.each(e,function(t){h.trigger(m,[t])}),t.data(R,!1)}),t.on(O,function(){if(!t.data(R)){var e=[],n=b.find("> tr");n.each(function(){var t=$(this),n=t.find(".region .region-editor"),i=n.find("input[type=hidden]"),a=JSON.parse(i.val()||"{}");e.push({Country:a.Country,RegionId:a.RegionId,FirstHeavyUnit:t.find(".first-heavy-unit input").val(),FirstHeavyCost:t.find(".first-heavy-cost input").val(),ContinuedHeavyUnit:t.find(".continued-heavy-unit input").val(),ContinuedHeavyCost:t.find(".continued-heavy-cost input").val(),Currency:t.find(".currency select").val(),Disabled:t.find(".disabled input").is(":checked")})}),s.val(JSON.stringify(e))}}),h.trigger(H)}},$(function(){var t=function(t){t.each(function(){$(this).logisticsPriceRulesEditor()})},e="[data-toggle='logistics-price-rules-editor']";t($(e)),$(document).on("dynamicLoaded",function(n,i){t($(i).find(e))})});