$.fn.productPropertyEditor=function(){var t=$(this);if(t.data("initialized"))return!0;t.data("initialized",!0);var e=t.closest("form").find("[name='"+t.attr("data-category-id-name")+"']"),a=t.closest("form").find("[name='"+t.attr("data-property-values-name")+"']");if(!e.length||!a.length)return void console.warn("init product property editor failed",e,a);var i="bind.productPropertyEditor",r="bindingLock",n="data-property-type",o="["+n+"]",d=function(t,e){var a=t.text().trim()!=e.trim();a&&t.text(e).css("color","#31708F")};t.on(i,function(){t.data(r,!0);var e=JSON.parse(a.val()||"[]"),i=_.groupBy(e,"propertyId");t.find(o).each(function(){var t=$(this),e=t.attr(n),a=t.data("property-id");if("textbox"==e){var r=_.first(i[a]);t.find("input[type='text']").val(r?r.name:"").change()}else if("checkbox"==e){var o=_.indexBy(i[a],"propertyValueId");t.find("input[type='checkbox']").each(function(){var t=$(this),e=o[t.val()];t.prop("checked",e?!0:!1).change(),e&&d(t.parent().find(".alias-text"),e.name)})}else if("dropdown-list"==e){var r=_.first(i[a]);t.find("select").val(r?r.propertyValueId:"").change()}else if("editable-dropdown-list"==e){var r=_.first(i[a]);t.find("select").val(r?r.propertyValueId:"").change(),t.find("input[type='text']").val(r?r.name:"").change()}}),t.data(r,!1)});var l="collect.productPropertyEditor";t.on(l,function(){if(!t.data(r)){var e=[];t.find(o).each(function(){var t=$(this),a=t.attr(n),i=t.data("property-id");if("textbox"==a){var r=t.find("input[type='text']").val();r&&e.push({propertyId:i,name:r})}else if("checkbox"==a)t.find("input[type='checkbox']:checked").each(function(){var t=$(this),a=t.parent().find(".alias-text").text().trim(),r=t.val();r&&e.push({propertyId:i,propertyValueId:r,name:a})});else if("dropdown-list"==a){var o=t.find("select"),d=o.find("option:selected").text().trim(),r=o.val();r&&e.push({propertyId:i,propertyValueId:r,name:d})}else if("editable-dropdown-list"==a){var o=t.find("select"),d=t.find("input[type='text']").val().trim(),l=o.find("option:selected").text().trim(),r=d==l?o.val():"";d&&e.push({propertyId:i,propertyValueId:r,name:d})}else console.warn("unknow property type",a)}),a.val(JSON.stringify(e))}});var p=t.data("translations")||{},c=function(){var r=e.val(),n=t.data("categoryId"),c="Sure to change category? The properties you selected will lost!";return n&&n!=r&&!confirm(p[c]||c)?(e.val(n),!1):(t.data("categoryId",r),void t.load("/product/property_editor?categoryId="+r,function(){var e=".property-value-alias";t.find(e+" .alias-edit-btn").on("click",function(){var t=$(this).closest(e),a=t.find(".alias-editor"),i=t.find(".alias-text");return t.toggleClass("editing").hasClass("editing")&&a.val(i.text()),!1}),t.find(e+" .alias-editor").on("change",function(){var t=$(this),a=t.closest(e);d(a.find(".alias-text"),t.val())}),t.find(e).on("click",function(){return $(this).hasClass("editing")?!1:null}),n&&n!=r&&a.val(""),t.trigger(i),t.find(o).find("input, select").on("change",function(){t.trigger(l)})}))};e.on("change",c),c.call(e)},$(function(){var t=function(t){t.each(function(){$(this).productPropertyEditor()})},e="[data-toggle='product-property-editor']";t($(e)),$(document).on("dynamicLoaded",function(a,i){t($(i).find(e))})});